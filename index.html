<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hammurabi Javascript Port</title>
</head>
<body>
<canvas id="gameboard" width="500" height="200"></canvas>

<fieldset style="width:500px">
    <legend>

        I await your wise orders, oh hammurabi

    </legend>


    <form id="buylandfrm">

        <label for="buyland">
            Acres Land <input type="text" name="buyland" id="buyland" disabled="disabled" tabindex="10">
            <input type="button" value="buy" id="buylandbtn" disabled="disabled" tabindex="20">
        </label>

    </form>


    <form id="selllandfrm">

        <label for="sellland">
            Acres Land <input type="text" name="sellland" id="sellland" disabled="disabled" tabindex="30">
            <input type="button" value="sell" id="selllandbtn" disabled="disabled" tabindex="40">

        </label>

    </form>

    <form id="feedpeoplefrm">


        <label for="feedpeople">
            Shffl Grain <input type="text" name="feedpeople" id="feedpeople" disabled="disabled" tabindex="50">
            <input type="button" value="feed to the people" id="feedpeoplebtn" disabled="disabled" tabindex="60">
        </label>

    </form>

    <form id="plantfoodfrm">

        <label for="plantfood">
            Acres Land <input type="text" name="plantfood" id="plantfood" disabled="disabled" tabindex="70">
            <input type="button" value="plant food" id="plantfoodbtn" disabled="disabled" tabindex="80">
        </label>

    </form>


</fieldset>


<script type="text/javascript">

    var helper = {};

    helper.getSuffix = (number) => {
        if (number === 1) return "1st";
        else return number + "nd";
    };


    helper.buyLand = document.getElementById('buyland');
    helper.buyLandBtn = document.getElementById('buylandbtn');
    helper.buyLandForm = document.getElementById('buylandfrm');

    helper.sellLand = document.getElementById('sellland');
    helper.sellLandBtn = document.getElementById('selllandbtn');
    helper.sellLandForm = document.getElementById('selllandfrm');

    helper.feedPeople = document.getElementById('feedpeople');
    helper.feedPeopleBtn = document.getElementById('feedpeoplebtn');
    helper.feedPeopleForm = document.getElementById('feedpeoplefrm');

    helper.plantFood = document.getElementById('plantfood');
    helper.plantFoodBtn = document.getElementById('plantfoodbtn');
    helper.plantFoodForm = document.getElementById('plantfoodfrm');


    var Hamurabi;
    Hamurabi = {

        _init: () => {
            this.displayCtx = document.getElementById('gameboard').getContext('2d');
            this.displayCtx.font = "16px sans-serif";
            this.population = 95;
            this.immigrants = 5;
            this.deceased = 0;
            this.grainInSilo = 3000;
            this.acresLand = 1000;
            this.yearOfRule = 1;

            this.landCosts = Hamurabi._currentCostAcreLand();

            Hamurabi.start();
        },


        _rollDice: () => {

            return Math.floor(Math.random() * 7);

        },


        _totalPopulation: () => {
            return this.population += this.immigrants;
        },

        _currentCostAcreLand: () => {

            return Math.floor(Math.random() * 11) + 16;

        },


        start: () => {
            Hamurabi.startYear();
            Hamurabi._report();
        },

        _report: () => {

            this.displayCtx.clearRect(0, 0, 500, 200);

            var y = 16;
            this.displayCtx.fillText('HAMURABI:  i beg to report you, in the ' + helper.getSuffix(this.yearOfRule) + ' year of your rule', 0, y);
            y += 16;
            this.displayCtx.fillText(this.deceased + ' people died. ' + this.immigrants + ' came to the city', 0, y);
            y += 16;
            this.displayCtx.fillText('You own: ' + this.acresLand + ' Acres Land', 0, y);
            y += 16;
            this.displayCtx.fillText('One Acre of Land costs ' + this.landCosts + ' Sheffels grain', 0, y);
            y += 16;
            this.displayCtx.fillText('You own: ' + this.grainInSilo + ' Sheffels corn', 0, y);
            y += 16;
            this.displayCtx.fillText(Hamurabi._totalPopulation() + ' people live in the city', 0, y);
            y += 16;
            y += 16;
            this.displayCtx.fillText('What are your orders?', 0, y);

            this.population = this.population + this.immigrants - this.deceased;
            this.immigrants = 0;
            this.deceased = 0;
        },


        startYear: () => {
            helper.buyLand.removeAttribute('disabled');
            helper.buyLandBtn.removeAttribute('disabled');
            helper.buyLand.focus();
        },

        incorrectInput: () => {
            alert('Hammurabi you can only enter numbers');
        },

        handleBuyLandInput: () => {
            var input = parseInt(helper.buyLand.value);
            if (isNaN(input)) {
                Hamurabi.incorrectInput();
                helper.buyLand.value = "";
                helper.buyLand.focus();
            } else {
                if (input * this.landCosts < this.grainInSilo) {
                    var price = input * this.landCosts;
                    this.grainInSilo -= price;
                    this.acresLand += input;

                    helper.buyLand.setAttribute('disabled', 'disabled');
                    helper.buyLandBtn.setAttribute('disabled', 'disabled');

                    helper.sellLand.removeAttribute('disabled');
                    helper.sellLandBtn.removeAttribute('disabled');
                    helper.sellLand.focus();
                    Hamurabi._report();

                } else {
                    alert('Think again Hamurabi, you only have ' + this.grainInSilo + ' Sheffels corn - you try to spend ' + (input * this.landCosts) + " cost " + this.landCosts);
                    helper.buyLand.focus();
                }

            }

        },

        handleSellLandInput: () => {
            var input = helper.sellLand.value;

            if (isNaN(input)) {
                Hamurabi.incorrectInput();
                helper.sellLand.value = "";
                helper.sellLand.focus();
            } else {
                if (input < this.acresLand) {
                    this.grainInSilo += input * this.landCosts;
                    this.acresLand -= input;

                    helper.sellLand.setAttribute('disabled', 'disabled');
                    helper.sellLandBtn.setAttribute('disabled', 'disabled');

                    helper.feedPeople.removeAttribute('disabled');
                    helper.feedPeopleBtn.removeAttribute('disabled');
                    helper.feedPeople.focus();
                    Hamurabi._report();
                } else {
                    alert('Think again Hamurabi, you only own ' + this.acresLand + ' Acres of land');
                    helper.sellLand.focus();
                }
            }

        },

        handleFeedPeopleInput: () => {
            var input = helper.feedPeople.value;
            if (isNaN(input)) {
                Hamurabi.incorrectInput();
                helper.feedPeople.value = "";
                helper.feedPeople.focus();
            } else {
                if (input < this.grainInSilo) {
                    this.grainInSilo -= input;
                    this.fullTummies = parseInt(input / 20);

                    // console.log(this.fullTummies);

                    helper.feedPeople.setAttribute('disabled', 'disabled');
                    helper.feedPeopleBtn.setAttribute('disabled', 'disabled');

                    helper.plantFood.removeAttribute('disabled');
                    helper.plantFoodBtn.removeAttribute('disabled');
                    helper.plantFood.focus();

                    // Hamurabi._report();
                } else {
                    alert('Think again Hamurabi, you only own ' + this.grainInSilo + ' Sheffels corn');
                    helper.feedPeople.focus();
                }
            }

        },

        handlePlantFoodInput: () => {
            var input = helper.plantFood.value;
            if (isNaN(input)) {
                Hamurabi.incorrectInput();
                helper.plantFood.value = "";
                helper.plantFood.focus();
            } else {
                if (input / 2 < this.grainInSilo && input < this.population * 10) {


                    helper.plantFood.setAttribute('disabled', 'disabled');
                    helper.plantFoodBtn.setAttribute('disabled', 'disabled');

                    // Harvest
                    this.grainInSilo += input * Hamurabi._rollDice();
                    Hamurabi.gameturn();

                } else {
                    if (input / 2 >= this.grainInSilo) {
                        alert('Think again Hamurabi, you only own ' + this.grainInSilo + ' Sheffels corn');
                    } else if (input >= this.population * 10) {
                        alert('Think again Hamurabi, only ' + this.population + ' people can work on the fields');
                    }

                    helper.plantFood.focus();
                }

            }

        },


        gameturn: () => {

            var plaqueStrikes;
            plaqueStrikes = parseInt(10 * (2 * Math.random() - .3));

            if (plaqueStrikes < 0) {
                alert('Plague - half people die!!!');
                this.population = Math.floor(this.population / 2);
            }

            this.immigrants = Hamurabi._rollDice() * (20 * this.acresLand + this.grainInSilo) / this.population / 100 + 1;
            this.deceased = this.population - this.fullTummies;


            this.yearOfRule += 1;
            Hamurabi._report();
            Hamurabi.startYear();
        },


    };

    Hamurabi._init();

    helper.buyLandForm.addEventListener('submit', (evt) => {
        evt.preventDefault();
        Hamurabi.handleBuyLandInput();
    });

    helper.sellLandForm.addEventListener('submit', (evt) => {
        evt.preventDefault();
        Hamurabi.handleSellLandInput();
    });

    helper.feedPeopleForm.addEventListener('submit', (evt) => {
        evt.preventDefault();
        Hamurabi.handleFeedPeopleInput();
    });

    helper.plantFoodForm.addEventListener('submit', (evt) => {
        evt.preventDefault();
        Hamurabi.handlePlantFoodInput();
    });


</script>

</body>
</html>


<!-- Credits & References:
https://www.atariarchives.org/basicgames/showpage.php?page=78
https://web.archive.org/web/20150120012304/http://www.dunnington.u-net.com/public/basicgames/HMRABI
https://stackoverflow.com/questions/22317805/how-to-make-canvas-element-in-html-clickable
//-->
