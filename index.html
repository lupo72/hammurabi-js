<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hammurabi Javascript Port</title>
</head>
<body>
<canvas id="gameboard" width="500" height="200">


</canvas>

<form id="commands">


    <label for="buyland">
        Acres Land <input type="text" name="buyland" id="buyland" disabled="disabled" tabindex="10">
        <input type="button" value="buy" id="buylandbtn" disabled="disabled" tabindex="20">
    </label>

    <br>


    <label for="sellland">
        Acres Land <input type="text" name="sellland" id="sellland" disabled="disabled" tabindex="30">
        <input type="button" value="sell" id="selllandbtn" disabled="disabled" tabindex="40">

    </label>

    <br>


    <label for="feedpeople">
        Bushels Grain <input type="text" name="feedpeople" id="feedpeople" disabled="disabled" tabindex="50">
        <input type="button" value="feed to the people" id="feedpeoplebtn" disabled="disabled" tabindex="60">
    </label>

    <br>


    <label for="plantfood">
        Bushels Grain <input type="text" name="plantfood" id="plantfood" disabled="disabled" tabindex="70">
        <input type="button" value="plant" id="plantfoodbtn" disabled="disabled" tabindex="80">
    </label>


</form>

<script type="text/javascript">


    var helper = {};

    helper.getSuffix = (number) => {
        if (number === 1) return "1st";
        else return number + "nd";
    };


    helper.buyLand = document.getElementById('buyland');
    helper.buyLandBtn = document.getElementById('buylandbtn');

    helper.sellLand = document.getElementById('sellland');
    helper.sellLandBtn = document.getElementById('selllandbtn');

    helper.feedPeople = document.getElementById('feedpeople');
    helper.feedPeopleBtn = document.getElementById('feedpeoplebtn');

    helper.plantFood = document.getElementById('plantfood');
    helper.plantFoodBtn = document.getElementById('plantfoodbtn');


    helper.defineShape = (shape, ctx) => {
        var points = shape.points;
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        for (var i = 1; i < points.length; i++) {
            ctx.lineTo(points[i].x, points[i].y);
        }
    };

    helper.drawShape = (shape, ctx) => {
        helper.defineShape(shape, ctx);
        ctx.fill();
        ctx.stroke();
    };


    function handleMouseDown(e) {
        e.preventDefault();

        var $canvas = document.getElementById('gameboard');
        var ctx = $canvas.getContext('2d');

        var offsetX = $canvas.offsetLeft;
        var offsetY = $canvas.offsetTop;

        // get the mouse position
        var mouseX = parseInt(e.clientX - offsetX);
        var mouseY = parseInt(e.clientY - offsetY);

        // console.log(offsetX, offsetY, mouseX, mouseY);

        // iterate each shape in the shapes array
        for (var i = 0; i < shapes.length; i++) {
            var shape = shapes[i];
            // define the current shape
            helper.defineShape(shape, ctx);
            // test if the mouse is in the current shape
            if (ctx.isPointInPath(mouseX, mouseY)) {
                // if inside, display the shape's message
                alert(shape.message);
            }
        }

    }


    var gameboard = document.getElementById('gameboard').onmousedown = function (e) {
        handleMouseDown(e);
    };

    var triangle = {
        points: [{x: 25, y: 100}, {x: 50, y: 50}, {x: 75, y: 100}],
        message: "I am a triangle"
    };

    var parallelogram = {
        points: [{x: 150, y: 50}, {x: 250, y: 50}, {x: 200, y: 100}, {x: 100, y: 100}],
        message: "I am a parallelogram"
    };

    // save the triangle and parallelogram in a shapes[] array

    var shapes = [];
    shapes.push(triangle);
    shapes.push(parallelogram);


    var Hamurabi;
    Hamurabi = {

        _init: () => {
            this.displayCtx = document.getElementById('gameboard').getContext('2d');
            this.displayCtx.font = "16px sans-serif";
            this.population = 95;
            this.immigrants = 5;
            this.deceased = 0;
            this.grainInSilo = 3000;
            this.acresLand = 1000;
            this.yearOfRule = 1;

            this.landCosts = Hamurabi._currentCostAcreLand();

            Hamurabi._hud();
        },


        _rollDice: () => {

            return Math.floor(Math.random() * 7);

        },


        _totalPopulation: () => {
            return this.population += this.immigrants;
        },

        _currentCostAcreLand: () => {

            return Math.floor(Math.random() * 11) + 16;

        },


        _hud: () => {

            // this.displayCtx.beginPath();
            // this.displayCtx.arc(70, 80, 10, 0, 2 * Math.PI, false);
            // this.displayCtx.fill();

            // helper.drawShape(triangle, this.displayCtx);
            // helper.drawShape(parallelogram, this.displayCtx);

            Hamurabi._report();
        },

        _report: () => {

            var y = 16;
            this.displayCtx.fillText('HAMURABI:  i beg to report you, in the ' + helper.getSuffix(this.yearOfRule) + ' year of your rule', 0, y);
            y += 16;
            this.displayCtx.fillText(this.deceased + ' people died. ' + this.immigrants + ' came to the city', 0, y);
            y += 16;
            this.displayCtx.fillText('You own: ' + this.acresLand + ' Acres Land', 0, y);
            y += 16;
            this.displayCtx.fillText('You own: ' + this.grainInSilo + ' grainInSilo corn', 0, y);
            y += 16;
            this.displayCtx.fillText('One Acre of Land costs ' + this.landCosts + ' grainInSilo corn', 0, y);
            y += 16;
            this.displayCtx.fillText(Hamurabi._totalPopulation() + ' people live in the city', 0, y);
            y += 16;
            y += 16;
            this.displayCtx.fillText('What are your orders?', 0, y);

            this.population += this.immigrants;
            this.immigrants = 0;
            Hamurabi.startYear();
        },


        startYear: () => {

            helper.buyLand.removeAttribute('disabled');
            helper.buyLandBtn.removeAttribute('disabled');
            helper.buyLand.focus();

        },

        handleBuyLandInput() {
            var b = helper.buyLand.value;
            alert(parseInt(b));
            this.buyAcres = b;
            helper.buyLand.setAttribute('disabled', 'disabled');
            helper.buyLandBtn.setAttribute('disabled', 'disabled')

            helper.sellLand.removeAttribute('disabled');
            helper.sellLandBtn.removeAttribute('disabled');
            helper.sellLand.focus();

        },

        handleSellLandInput() {
            var s = helper.sellLand.value;
            alert(parseInt(s));
            this.sellAcres = s;
            helper.sellLand.setAttribute('disabled', 'disabled');
            helper.sellLandBtn.setAttribute('disabled', 'disabled')

            helper.feedPeople.removeAttribute('disabled');
            helper.feedPeopleBtn.removeAttribute('disabled');
            helper.feedPeople.focus();
        },

        handleFeedPeopleInput() {
            var f = helper.feedPeople.value;
            alert(parseInt(f));
            this.feedPeople = f;
            helper.feedPeople.setAttribute('disabled', 'disabled');
            helper.feedPeopleBtn.setAttribute('disabled', 'disabled')

            helper.plantFood.removeAttribute('disabled');
            helper.plantFoodBtn.removeAttribute('disabled');
            helper.plantFood.focus();
        },

        handlePlantFoodInput() {
            var p = helper.plantFood.value;
            alert(parseInt(p));
            this.plantFood = p;
            helper.plantFood.setAttribute('disabled', 'disabled');
            helper.plantFoodBtn.setAttribute('disabled', 'disabled')

            // helper.plantFood.removeAttribute('disabled');
            // helper.plantFoodBtn.removeAttribute('disabled');
            // helper.plantFood.focus();

            Hamurabi.gameturn();

        },


        gameturn: () => {

            var plaqueStrikes;
            plaqueStrikes = parseInt(10 * (2 * Math.random() - .3));
            console.log(plaqueStrikes);

        },


    };

    Hamurabi._init();

    document.getElementById('buylandbtn').addEventListener('click', (evt) => {
        Hamurabi.handleBuyLandInput();
    });

    document.getElementById('selllandbtn').addEventListener('click', (evt) => {
        Hamurabi.handleSellLandInput();
    });

    document.getElementById('feedpeoplebtn').addEventListener('click', (evt) => {
        Hamurabi.handleFeedPeopleInput();
    });

    document.getElementById('plantfoodbtn').addEventListener('click', (evt) => {
        Hamurabi.handlePlantFoodInput();
    });


</script>

</body>
</html>


<!-- Credits & References:
https://www.atariarchives.org/basicgames/showpage.php?page=78
https://web.archive.org/web/20150120012304/http://www.dunnington.u-net.com/public/basicgames/HMRABI
https://stackoverflow.com/questions/22317805/how-to-make-canvas-element-in-html-clickable
//-->
